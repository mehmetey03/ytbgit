name: ğŸµ Playlist GÃ¼ncelleme

on:
  schedule:
    - cron: '0 * * * *'  # Her saat baÅŸÄ± Ã§alÄ±ÅŸÄ±r
  workflow_dispatch:     # Elle baÅŸlatmak iÃ§in

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Repo'yu klonla
        uses: actions/checkout@v3

      - name: Gerekli paketleri yÃ¼kle
        run: sudo apt update && sudo apt install -y jq curl git

      - name: Playlist oluÅŸtur
        run: |
          mkdir -p playlist
          rm -f playlist/*

          if [ ! -f link.json ]; then
            echo "link.json bulunamadÄ±!"
            exit 1
          fi

          cat link.json | jq -c '.[]' | while read -r i; do
              name=$(echo "$i" | jq -r '.name')
              url=$(echo "$i" | jq -r '.url')
              echo "ğŸ“¥ $name indiriliyor..."
              curl -sSL "$url" \
                  -H "User-Agent: Mozilla/5.0" \
                  -H "Referer: https://live.artofknot.com/" \
                  -o "playlist/${name}.m3u8"
          done

          echo "#EXTM3U" > playlist.m3u
          for file in playlist/*.m3u8; do
              name=$(basename "$file" .m3u8)
              echo "#EXTINF:-1,$name" >> playlist.m3u
              echo "https://raw.githubusercontent.com/${{ github.repository }}/main/playlist/${name}.m3u8" >> playlist.m3u
          done

          mv playlist.m3u playlist/playlist.m3u

      - name: DeÄŸiÅŸiklikleri GitHub'a gÃ¶nder
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          git add playlist
          git commit -m "âœ… Playlist gÃ¼ncellendi: $(date)" || echo "No changes to commit"
          git push
